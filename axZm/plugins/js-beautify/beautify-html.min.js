/*
  Style HTML
  MIT License (MIT)
  Copyright (c) 2007-2013 Einar Lielmanis and contributors.
  Written by Nochum Sossonko, (nsossonko@hotmail.com)
  Based on code initially developed by: Einar Lielmanis, <elfz@laacz.lv>
    http://jsbeautifier.org/
*/

if("undefined"!==typeof process&&"node"===process.argv[0])var css_beautify=require(__dirname+"/beautify-css.js").css_beautify,js_beautify=require(__dirname+"/beautify.js").js_beautify;
function style_html(p,f){var a,c,j,h,k,m;f=f||{};c=f.indent_size||4;j=f.indent_char||" ";k=f.brace_style||"collapse";h=0===f.max_char?Infinity:f.max_char||250;m=f.unformatted||"a span bdo em strong dfn code samp kbd var cite abbr acronym q sub sup tt i b big small u s strike font ins del pre address dt h1 h2 h3 h4 h5 h6".split(" ");a=new function(){this.pos=0;this.token="";this.current_mode="CONTENT";this.tags={parent:"parent1",parentcount:1,parent1:""};this.token_text=this.last_token=this.last_text=
this.token_type=this.tag_type="";this.Utils={whitespace:["\n","\r","\t"," "],single_token:"br input link meta !doctype basefont base area hr wbr param img isindex ?xml embed ?php ? ?=".split(" "),extra_liners:["head","body","/html"],in_array:function(b,g){for(var a=0;a<g.length;a++)if(b===g[a])return!0;return!1}};this.get_content=function(){for(var b="",g=[],a=!1;"<"!==this.input.charAt(this.pos);){if(this.pos>=this.input.length)return g.length?g.join(""):["","TK_EOF"];b=this.input.charAt(this.pos);
this.pos++;this.line_char_count++;if(this.Utils.in_array(b,this.Utils.whitespace))g.length&&(a=!0),this.line_char_count--;else{if(a){if(this.line_char_count>=this.max_char){g.push("\n");for(a=0;a<this.indent_level;a++)g.push(this.indent_string);this.line_char_count=0}else g.push(" "),this.line_char_count++;a=!1}g.push(b)}}return g.length?g.join(""):""};this.get_contents_to=function(b){if(this.pos===this.input.length)return["","TK_EOF"];var a="";b=RegExp("</"+b+"\\s*>","igm");b.lastIndex=this.pos;
b=(b=b.exec(this.input))?b.index:this.input.length;this.pos<b&&(a=this.input.substring(this.pos,b),this.pos=b);return a};this.record_tag=function(b){this.tags[b+"count"]?this.tags[b+"count"]++:this.tags[b+"count"]=1;this.tags[b+this.tags[b+"count"]]=this.indent_level;this.tags[b+this.tags[b+"count"]+"parent"]=this.tags.parent;this.tags.parent=b+this.tags[b+"count"]};this.retrieve_tag=function(b){if(this.tags[b+"count"]){for(var a=this.tags.parent;a&&b+this.tags[b+"count"]!==a;)a=this.tags[a+"parent"];
a&&(this.indent_level=this.tags[b+this.tags[b+"count"]],this.tags.parent=this.tags[a+"parent"]);delete this.tags[b+this.tags[b+"count"]+"parent"];delete this.tags[b+this.tags[b+"count"]];1===this.tags[b+"count"]?delete this.tags[b+"count"]:this.tags[b+"count"]--}};this.get_tag=function(b){var a="",e=[],a="",d=!1,c,f=this.pos,n=this.line_char_count;b=void 0!==b?b:!1;do{if(this.pos>=this.input.length)return b&&(this.pos=f,this.line_char_count=n),e.length?e.join(""):["","TK_EOF"];a=this.input.charAt(this.pos);
this.pos++;this.line_char_count++;if(this.Utils.in_array(a,this.Utils.whitespace))d=!0,this.line_char_count--;else{if("'"===a||'"'===a)if(!e[1]||"!"!==e[1])a+=this.get_unformatted(a),d=!0;"="===a&&(d=!1);e.length&&("="!==e[e.length-1]&&">"!==a&&d)&&(this.line_char_count>=this.max_char?(this.print_newline(!1,e),this.line_char_count=0):(e.push(" "),this.line_char_count++),d=!1);"<"===a&&(c=this.pos-1);e.push(a)}}while(">"!==a);a=e.join("");d=-1!==a.indexOf(" ")?a.indexOf(" "):a.indexOf(">");d=a.substring(1,
d).toLowerCase();"/"===a.charAt(a.length-2)||this.Utils.in_array(d,this.Utils.single_token)?b||(this.tag_type="SINGLE"):"script"===d?b||(this.record_tag(d),this.tag_type="SCRIPT"):"style"===d?b||(this.record_tag(d),this.tag_type="STYLE"):this.is_unformatted(d,m)?(a=this.get_unformatted("</"+d+">",a),e.push(a),0<c&&this.Utils.in_array(this.input.charAt(c-1),this.Utils.whitespace)&&e.splice(0,0,this.input.charAt(c-1)),c=this.pos-1,this.Utils.in_array(this.input.charAt(c+1),this.Utils.whitespace)&&e.push(this.input.charAt(c+
1)),this.tag_type="SINGLE"):"!"===d.charAt(0)?-1!==d.indexOf("[if")?(-1!==a.indexOf("!IE")&&(a=this.get_unformatted("--\x3e",a),e.push(a)),b||(this.tag_type="START")):-1!==d.indexOf("[endif")?(this.tag_type="END",this.unindent()):-1!==d.indexOf("[cdata[")?(a=this.get_unformatted("]]\x3e",a),e.push(a),b||(this.tag_type="SINGLE")):(a=this.get_unformatted("--\x3e",a),e.push(a),this.tag_type="SINGLE"):b||("/"===d.charAt(0)?(this.retrieve_tag(d.substring(1)),this.tag_type="END"):(this.record_tag(d),this.tag_type=
"START"),this.Utils.in_array(d,this.Utils.extra_liners)&&this.print_newline(!0,this.output));b&&(this.pos=f,this.line_char_count=n);return e.join("")};this.get_unformatted=function(a,c){if(c&&-1!==c.toLowerCase().indexOf(a))return"";var e="",d="",f=!0;do{if(this.pos>=this.input.length)break;e=this.input.charAt(this.pos);this.pos++;if(this.Utils.in_array(e,this.Utils.whitespace)){if(!f){this.line_char_count--;continue}if("\n"===e||"\r"===e){d+="\n";this.line_char_count=0;continue}}d+=e;this.line_char_count++;
f=!0}while(-1===d.toLowerCase().indexOf(a));return d};this.get_token=function(){var a;if("TK_TAG_SCRIPT"===this.last_token||"TK_TAG_STYLE"===this.last_token){var c=this.last_token.substr(7);a=this.get_contents_to(c);return"string"!==typeof a?a:[a,"TK_"+c]}if("CONTENT"===this.current_mode)return a=this.get_content(),"string"!==typeof a?a:[a,"TK_CONTENT"];if("TAG"===this.current_mode)return a=this.get_tag(),"string"!==typeof a?a:[a,"TK_TAG_"+this.tag_type]};this.get_full_indent=function(a){a=this.indent_level+
a||0;return 1>a?"":Array(a+1).join(this.indent_string)};this.is_unformatted=function(a,c){if(!this.Utils.in_array(a,c))return!1;if("a"!==a.toLowerCase()||!this.Utils.in_array("a",c))return!0;var e=(this.get_tag(!0)||"").match(/^\s*<\s*\/?([a-z]*)\s*[^>]*>\s*$/);return!e||this.Utils.in_array(e,c)?!0:!1};this.printer=function(a,c,e,d,f){this.input=a||"";this.output=[];this.indent_character=c;this.indent_string="";this.indent_size=e;this.brace_style=f;this.indent_level=0;this.max_char=d;for(a=this.line_char_count=
0;a<this.indent_size;a++)this.indent_string+=this.indent_character;this.print_newline=function(a,b){this.line_char_count=0;if(b&&b.length){if(!a)for(;this.Utils.in_array(b[b.length-1],this.Utils.whitespace);)b.pop();b.push("\n");for(var c=0;c<this.indent_level;c++)b.push(this.indent_string)}};this.print_token=function(a){this.output.push(a)};this.indent=function(){this.indent_level++};this.unindent=function(){0<this.indent_level&&this.indent_level--}};return this};for(a.printer(p,j,c,h,k);;){c=a.get_token();
a.token_text=c[0];a.token_type=c[1];if("TK_EOF"===a.token_type)break;switch(a.token_type){case "TK_TAG_START":a.print_newline(!1,a.output);a.print_token(a.token_text);a.indent();a.current_mode="CONTENT";break;case "TK_TAG_STYLE":case "TK_TAG_SCRIPT":a.print_newline(!1,a.output);a.print_token(a.token_text);a.current_mode="CONTENT";break;case "TK_TAG_END":"TK_CONTENT"===a.last_token&&""===a.last_text&&(c=a.token_text.match(/\w+/)[0],j=a.output[a.output.length-1].match(/<\s*(\w+)/),(null===j||j[1]!==
c)&&a.print_newline(!0,a.output));a.print_token(a.token_text);a.current_mode="CONTENT";break;case "TK_TAG_SINGLE":c=a.token_text.match(/^\s*<([a-z]+)/i);(!c||!a.Utils.in_array(c[1],m))&&a.print_newline(!1,a.output);a.print_token(a.token_text);a.current_mode="CONTENT";break;case "TK_CONTENT":""!==a.token_text&&a.print_token(a.token_text);a.current_mode="TAG";break;case "TK_STYLE":case "TK_SCRIPT":if(""!==a.token_text){a.output.push("\n");c=a.token_text;var l;h=1;"TK_SCRIPT"===a.token_type?l="function"===
typeof js_beautify&&js_beautify:"TK_STYLE"===a.token_type&&(l="function"===typeof css_beautify&&css_beautify);"keep"===f.indent_scripts?h=0:"separate"===f.indent_scripts&&(h=-a.indent_level);j=a.get_full_indent(h);l?c=l(c.replace(/^\s*/,j),f):(k=c.match(/^\s*/)[0].match(/[^\n\r]*$/)[0].split(a.indent_string).length-1,h=a.get_full_indent(h-k),c=c.replace(/^\s*/,j).replace(/\r\n|\r|\n/g,"\n"+h).replace(/\s*$/,""));c&&(a.print_token(c),a.print_newline(!0,a.output))}a.current_mode="TAG"}a.last_token=
a.token_type;a.last_text=a.token_text}return a.output.join("")}"undefined"!==typeof exports&&(exports.html_beautify=style_html);